services:
  zabbix-proxy-sqlite3:
    # SUBSTITUIÇÃO: Usa 'build' em vez de 'image' para criar a imagem customizada
    build:
      context: .
      dockerfile: Dockerfile
    
    ports:
      - '10051:10051'
      
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
      - "/etc/odbc.ini:/etc/odbc.ini"    # Mapeia o DSN (TOTALBANCO_MONITOR)
      # Nota: o odbcinst.ini é criado e configurado dentro do Dockerfile,
      # mas o mapeamento original foi mantido caso você precise usar um arquivo host
      - "/etc/odbcinst.ini:/etc/odbcinst.ini" 
      - "/etc/oracle:/etc/oracle"        # Mapeia o TNSNAMES.ORA
      
    environment:
      # Configurações do Proxy
      - 'ZBX_SERVER_HOST=10.0.2.120'
      - 'ZBX_SERVER_PORT=10051'
      - 'ZBX_HOSTNAME=Proxy-Randon'  
      
      # Buffer e Frequências
      - 'ZBX_PROXYLOCALBUFFER=24'
      - 'ZBX_PROXYOFFLINEBUFFER=24'
      - 'ZBX_PROXYHEARTBEATFREQUENCY=60'
      - 'ZBX_CONFIGFREQUENCY=600'
      - 'ZBX_DATASENDERFREQUENCY=30'
      
      # Processos Iniciais (StartPollers, etc.)
      - 'ZBX_ENABLEREMOTECOMMANDS=1'
      - 'ZBX_STARTPOLLERS=15'
      - 'ZBX_STARTPOLLERSUNREACHABLE=10'
      - 'ZBX_STARTPREPROCESSORS=10'
      - 'ZBX_STARTHTTPPOLLERS=15'
      - 'ZBX_STARTTRAPPERS=20'
      - 'ZBX_STARTPINGERS=15'
      - 'ZBX_STARTDISCOVERERS=5'
      
      # Coleta VMware
      - 'ZBX_STARTVMWARECOLLECTORS=15'
      - 'ZBX_VMWAREFREQUENCY=60'
      - 'ZBX_VMWAREPERFFREQUENCY=60'
      - 'ZBX_VMWARECACHESIZE=256M'
      - 'ZBX_VMWARETIMEOUT=300'
      
      # Cache e Sincronização
      - 'ZBX_CACHESIZE=512M'
      - 'ZBX_STARTDBSYNCERS=8'
      - 'ZBX_HISTORYCACHESIZE=32M'
      - 'ZBX_HISTORYINDEXCACHESIZE=32M'
      - 'ZBX_TIMEOUT=30'
      
      # Configuração TNS (para acesso ao Oracle)
      - 'TNS_ADMIN=/etc/oracle'
      
      # Adicionais (melhor prática ao usar Instant Client)
      - 'LD_LIBRARY_PATH=/usr/lib/oracle/19.10/client64/lib'
